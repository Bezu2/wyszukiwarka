<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wyszukiwarka Nazwisk PESEL</title>
    <style>
        /* Modernistyczny, nowoczesny design z ciemnym motywem */
        body {
            background-color: #121212;
            color: #e0e0e0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            flex-direction: column;
        }

        header {
            text-align: center;
            margin-bottom: 2rem;
        }

        h1 {
            font-size: 2.5rem;
            margin: 0;
            color: #ffffff;
        }

        .search-container {
            background-color: #1e1e1e;
            padding: 2rem;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.5);
            width: 80%;
            max-width: 800px;
            text-align: center;
        }

        input[type="text"] {
            width: 70%;
            padding: 1rem;
            margin-bottom: 1rem;
            border: none;
            border-radius: 8px;
            background-color: #2c2c2c;
            color: #e0e0e0;
            font-size: 1.2rem;
            outline: none;
            transition: box-shadow 0.3s;
            display: inline-block;
            vertical-align: middle;
        }

        input[type="text"]:focus {
            box-shadow: 0 0 10px #4caf50;
        }

        button {
            background-color: #4caf50;
            color: #ffffff;
            border: none;
            padding: 1rem 2rem;
            border-radius: 8px;
            font-size: 1.2rem;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.1s;
            width: auto;
            display: inline-block;
            vertical-align: middle;
            margin-left: 1rem;
        }

        button:hover {
            background-color: #388e3c;
        }

        button:active {
            transform: scale(0.98);
        }

        .results {
            margin-top: 2rem;
            display: none;
        }

        .result-section {
            background-color: #2c2c2c;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 1rem;
        }

        h2 {
            font-size: 1.8rem;
            margin-top: 0;
            color: #ffffff;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 1rem;
        }

        th, td {
            padding: 0.8rem;
            text-align: left;
            border-bottom: 1px solid #3c3c3c;
        }

        th {
            background-color: #1e1e1e;
            color: #ffffff;
        }

        td {
            color: #e0e0e0;
        }

        .no-results {
            color: #ff5252;
            text-align: center;
        }

        footer {
            margin-top: 2rem;
            text-align: center;
            font-size: 0.9rem;
            color: #9e9e9e;
        }
    </style>
</head>
<body>
    <header>
        <h1>Wyszukiwarka Nazwisk z Rejestru PESEL</h1>
    </header>

    <div class="search-container">
        <input type="text" id="surnameInput" placeholder="Wpisz nazwisko...">
        <button onclick="searchSurname()">Szukaj</button>
    </div>

    <div class="results" id="results">
        <div class="result-section" id="maleResults">
            <h2>Nazwiska Męskie</h2>
            <div id="maleContent"></div>
        </div>
        <div class="result-section" id="femaleResults">
            <h2>Nazwiska Żeńskie</h2>
            <div id="femaleContent"></div>
        </div>
    </div>

    <footer>
        Dane na podstawie rejestru PESEL (stan na 24.02.2025). Źródło: dane.gov.pl PRÓBA 1
    </footer>

    <script>
        let maleData = null;
        let femaleData = null;
        let voivodeships = [];

        // Funkcja do parsowania CSV (zakładam format: WOJEWODZTWO;NAZWISKO;LICZBA)
        function parseCSV(csvText) {
            const lines = csvText.trim().split('\n');
            const data = {};

            for (let i = 0; i < lines.length; i++) {
                const parts = lines[i].split(';').map(part => part.trim());
                if (parts.length < 3) continue;
                const woj = parts[0];
                const surname = parts[1].toUpperCase(); // Normalizacja nazwiska
                const count = parseInt(parts[2]) || 0;

                if (!data[surname]) {
                    data[surname] = {};
                }
                data[surname][woj] = (data[surname][woj] || 0) + count; // Sumowanie, jeśli dane się powtarzają

                if (!voivodeships.includes(woj)) {
                    voivodeships.push(woj);
                }
            }
            return data;
        }

        // Ładowanie danych z plików CSV
        async function loadData() {
            if (maleData && femaleData) return;

            try {
                const maleResponse = await fetch('nazwiska_m.csv');
                if (!maleResponse.ok) throw new Error('Plik nazwiska_m.csv nie został znaleziony.');
                const maleText = await maleResponse.text();
                maleData = parseCSV(maleText);

                const femaleResponse = await fetch('nazwiska_k.csv');
                if (!femaleResponse.ok) throw new Error('Plik nazwiska_k.csv nie został znaleziony.');
                const femaleText = await femaleResponse.text();
                femaleData = parseCSV(femaleText);

                voivodeships.sort();
                console.log('Załadowane województwa:', voivodeships); // Debug
                console.log('Przykładowe męskie dane:', Object.keys(maleData).slice(0, 5)); // Debug
            } catch (error) {
                console.error('Błąd ładowania danych:', error.message);
                alert(`Błąd: ${error.message}. Upewnij się, że pliki CSV są w tym samym katalogu co HTML i są dostępne przez serwer.`);
            }
        }

        // Funkcja wyszukiwania
        async function searchSurname() {
            await loadData();

            const input = document.getElementById('surnameInput').value.trim().toUpperCase();
            if (!input) {
                alert('Wpisz nazwisko!');
                return;
            }

            const maleContent = document.getElementById('maleContent');
            const femaleContent = document.getElementById('femaleContent');
            const resultsDiv = document.getElementById('results');

            maleContent.innerHTML = '';
            femaleContent.innerHTML = '';

            if (!maleData || !femaleData) {
                resultsDiv.style.display = 'block';
                maleContent.innerHTML = '<p class="no-results">Błąd ładowania danych męskich.</p>';
                femaleContent.innerHTML = '<p class="no-results">Błąd ładowania danych żeńskich.</p>';
                return;
            }

            if (maleData[input] && Object.keys(maleData[input]).length > 0) {
                maleContent.innerHTML = createTable(maleData[input]);
            } else {
                maleContent.innerHTML = '<p class="no-results">Nie znaleziono nazwiska w rejestrze męskich.</p>';
            }

            if (femaleData[input] && Object.keys(femaleData[input]).length > 0) {
                femaleContent.innerHTML = createTable(femaleData[input]);
            } else {
                femaleContent.innerHTML = '<p class="no-results">Nie znaleziono nazwiska w rejestrze żeńskich.</p>';
            }

            resultsDiv.style.display = 'block';
        }

        // Tworzenie tabeli z wynikami
        function createTable(data) {
            let html = '<table><thead><tr><th>Województwo</th><th>Liczba wystąpień</th></tr></thead><tbody>';
            let total = 0;
            voivodeships.forEach(woj => {
                const count = data[woj] || 0;
                total += count;
                if (count > 0) { // Wyświetlaj tylko województwa z danymi
                    html += `<tr><td>${woj}</td><td>${count}</td></tr>`;
                }
            });
            html += `<tr><th>Razem</th><th>${total}</th></tr>`;
            html += '</tbody></table>';
            return html;
        }

        // Obsługa Entera
        document.getElementById('surnameInput').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                searchSurname();
            }
        });

        // Ładowanie danych przy starcie strony
        window.onload = loadData;
    </script>
</body>

</html>
